<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>TrendRadar Lite</title>
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="icon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      color-scheme: dark;
    }
    * {
      box-sizing: border-box;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: radial-gradient(circle at top, #1f2937 0, #020617 45%, #000 100%);
      color: #e5e7eb;
    }
    .app {
      max-width: 820px;
      margin: 0 auto;
    }
    h1 {
      font-size: 22px;
      margin: 0 0 6px;
      letter-spacing: 0.02em;
    }
    .subtitle {
      font-size: 12px;
      opacity: 0.75;
      margin-bottom: 8px;
    }
    #last-updated {
      font-size: 11px;
      opacity: 0.65;
      margin-bottom: 14px;
    }

    .header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }
    .badge {
      font-size: 10px;
      border-radius: 999px;
      padding: 2px 8px;
      background: rgba(148, 163, 184, 0.16);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: #e5e7eb;
      white-space: nowrap;
    }

    .region-section {
      margin-top: 20px;
      padding-top: 14px;
      border-top: 1px solid rgba(148, 163, 184, 0.24);
    }
    .region-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
    }
    .region-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .region-count {
      font-size: 11px;
      opacity: 0.7;
    }
    .region-pill {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(59, 130, 246, 0.12);
      border: 1px solid rgba(59, 130, 246, 0.45);
      color: #bfdbfe;
    }

    .region-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid rgba(30, 64, 175, 0.5);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.65);
    }
    .card:hover {
      border-color: rgba(56, 189, 248, 0.6);
      transform: translateY(-1px);
      transition: all 0.15s ease-out;
    }
    .source {
      font-size: 11px;
      opacity: 0.75;
      margin-bottom: 3px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .source-tag {
      font-size: 10px;
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.2);
      color: #e5e7eb;
    }
    .title {
      font-size: 14px;
      margin-bottom: 3px;
      line-height: 1.4;
    }
    .title a {
      color: #7dd3fc;
      text-decoration: none;
    }
    .title a:hover {
      text-decoration: underline;
    }
    .title-zh {
      font-size: 13px;
      color: #e5e7eb;
      opacity: 0.9;
      margin-bottom: 4px;
    }
    .meta {
      font-size: 11px;
      opacity: 0.65;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .meta span::before {
      content: "Â·";
      margin: 0 2px;
      opacity: 0.6;
    }
    .meta span:first-child::before {
      content: "";
      margin: 0;
    }
    .error {
      color: #fca5a5;
      font-size: 12px;
      margin-top: 10px;
    }

    @media (max-width: 600px) {
      body {
        padding: 14px;
      }
      .card {
        padding: 9px 10px;
      }
      .region-section {
        margin-top: 16px;
        padding-top: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header-row">
      <div>
        <h1>TrendRadar Lite</h1>
        <div class="subtitle">è‡ªåŠ¨æ±‡æ€»å¤šå›½ä¸»æµåª’ä½“çƒ­ç‚¹ Â· æ¯å¤©æ›´æ–°ä¸€æ¬¡</div>
      </div>
      <span class="badge">å®éªŒç‰ˆ Â· ä¸ªäººé¡¹ç›®</span>
    </div>
    <div id="last-updated" class="subtitle"></div>

    <div id="list"></div>
    <div id="error" class="error"></div>
  </div>

  <script>
    const REGION_CONFIG = [
      { key: "Global",       label: "ğŸŒ å…¨çƒ Global" },
      { key: "Brazil",       label: "ğŸ‡§ğŸ‡· å·´è¥¿ Brazil" },
      { key: "Indonesia",    label: "ğŸ‡®ğŸ‡© å°å°¼ Indonesia" },
      { key: "India",        label: "ğŸ‡®ğŸ‡³ å°åº¦ India" },
      { key: "Japan",        label: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬ Japan" },
      { key: "South Korea",  label: "ğŸ‡°ğŸ‡· éŸ©å›½ South Korea" },
      { key: "Saudi Arabia", label: "ğŸ‡¸ğŸ‡¦ æ²™ç‰¹ Saudi Arabia" },
    ];

    async function loadNews() {
      try {
        const res = await fetch('data/news.json?_=' + Date.now());
        if (!res.ok) throw new Error('æ— æ³•åŠ è½½æ•°æ®');
        const data = await res.json();

        const listEl = document.getElementById('list');
        const timeEl = document.getElementById('last-updated');
        const errorEl = document.getElementById('error');

        listEl.innerHTML = '';
        errorEl.textContent = '';

        if (!data.items || data.items.length === 0) {
          timeEl.textContent = '';
          listEl.innerHTML = '<div class="subtitle">æš‚æ—¶æ²¡æœ‰æ•°æ®ï¼Œè¯·ç¨åå†è¯•ï½</div>';
          return;
        }

        // æ›´æ–°æ—¶é—´ï¼ˆé»˜è®¤è§†ä¸ºåŒ—äº¬æ—¶é—´ï¼‰
        timeEl.textContent = 'æœ€åæ›´æ–°ï¼ˆUTC+8ï¼‰ï¼š' + (data.last_updated || '');

        // æŒ‰ region åˆ†ç»„
        const grouped = {};
        for (const item of data.items) {
          const key = item.region || "Global";
          if (!grouped[key]) grouped[key] = [];
          grouped[key].push(item);
        }

        // æŒ‰æˆ‘ä»¬å®šä¹‰çš„é¡ºåºæ¸²æŸ“
        REGION_CONFIG.forEach(({ key, label }) => {
          const list = grouped[key];
          if (!list || list.length === 0) return;

          const section = document.createElement('section');
          section.className = 'region-section';
          section.innerHTML = `
            <div class="region-header">
              <div class="region-title">
                <span class="region-pill">${label}</span>
              </div>
              <div class="region-count">${list.length} æ¡</div>
            </div>
            <div class="region-list"></div>
          `;

          const regionListEl = section.querySelector('.region-list');

          list.forEach((item, idx) => {
            const card = document.createElement('article');
            card.className = 'card';

            const safeUrl = item.url || item.link || '#';
            const pointsText = item.points ? `${item.points} points` : '';
            const commentsText = item.comments ? `${item.comments} comments` : '';
            const timeText = item.published || '';

            const metaParts = [];
            if (pointsText)   metaParts.push(pointsText);
            if (commentsText) metaParts.push(commentsText);
            if (timeText)     metaParts.push(timeText);

            card.innerHTML = `
              <div class="source">
                <span class="source-tag">${item.source || 'News'}</span>
              </div>
              <div class="title">
                <a href="${safeUrl}" target="_blank" rel="noopener noreferrer">
                  ${item.title || 'Untitled'}
                </a>
              </div>
              ${item.title_zh ? `<div class="title-zh">${item.title_zh}</div>` : ''}
              ${metaParts.length ? `
                <div class="meta">
                  ${metaParts.map(t => `<span>${t}</span>`).join('')}
                </div>
              ` : ''}
            `;
            regionListEl.appendChild(card);
          });

          listEl.appendChild(section);
        });
      } catch (e) {
        document.getElementById('error').textContent = 'åŠ è½½å¤±è´¥ï¼š' + e.message;
      }
    }

    loadNews();
  </script>
</body>
</html>
